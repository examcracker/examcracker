<video id="video" class="videostream" autoplay></video>
<p><button id="capture-button">Start</button>
<button id="stop-button">Stop</button></p>

<script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>

<script>
const constraints = {video: true, audio: true};

const captureVideoButton = document.getElementById('capture-button');

var videoBlob;

captureVideoButton.onclick = function() {
  navigator.mediaDevices.getUserMedia(constraints).
    then(handleSuccess).catch(handleError);
};

function handleSuccess(stream) {
  video.srcObject = stream;
  video.muted = true;
  recorder = new RecordRTCPromisesHandler(stream, {mimeType: 'video/webm', bitsPerSecond: 128000});
  recorder.startRecording().then(function() {console.info('Recording video ...');});
  recorder.stream = stream;
}

document.getElementById('stop-button').onclick = handleStop;

function handleStop() {
  video.srcObject.getTracks().forEach(function(track) {track.stop();});
  recorder.stopRecording().then(function() {console.info('stopRecording success');
            videoBlob = recorder.getBlob();
            video.muted = false;
			console.log(videoBlob);
			save();
  });
}

function save(){
  var a = document.createElement("a");
  document.body.appendChild(a);
  a.style = "display: none";
  var url = window.URL.createObjectURL(videoBlob);
  a.href = url;
  a.download = "video.webm";
  a.click();
  window.URL.revokeObjectURL(url);
  return false;
}
 
</script>
{% extends "__ecBase.html" %}
<html>
    {% load staticfiles %}

    {% block ImageSlider %}
    {% endblock ImageSlider %}

    {% block jumbotronBlock %}
    {% endblock jumbotronBlock %}

    {% block container %}

    {% block content %}
    <script src="{% static 'access/access.js' %}"></script>
    <script src="{% static 'rest_framework/coreapi-0.1.1.js' %}"></script>
    <script src="{% static 'shaka/shaka-player.compiled.js' %}"></script>

<div class="container-full">
    <div class="row">
            <div class="col-lg-8 col-xs-12 col-sm-12 col-md-12">
                <h2>{{ course.name }}</h2>
                <div id="shakaplayer">
                    <video id="encplayer" controls preload="auto" width="80%" height="80%" {% if isLive == "true" %} autoplay {% endif %}></video>
                </div>
                <h4>{{ session.name }}</h4>

            </div>
            <div class="col-lg-4 col-xs-12 col-sm-12 col-md-12">
                <h2>{{ ContentHeading }}</h2>
                <div class="container">
                <div class="panel-group" id="accordion">
                {% for subj, subjdetails in coursedetails.items %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h6 class="panel-title">
                                <a role="button" data-toggle="collapse"  aria-expanded="true" data-parent="#accordion" href="#{{ subj }}">
                                    <span class="accordion-title-icon-background collapsed"><i class="accordion-title-icon fas fa-plus"></i></span>
                                    <span class="accordion-title-icon-background expanded"><i class="accordion-title-icon fas fa-minus"></i></span>
                                    <font size="4"> {{ subj }}</font>
                                </a>
                            </h6>
                        </div>
                        <div id="{{ subj }}" class="collapse show">
                        <div class="panel-body">
                    {% for s in subjdetails %}
                    {% for chapid, chapdetails in s.items %}

                    <div class="panel">
                            <div class="panel-heading">
                             <h6 class="panel-title">
                                 <a role="button" data-toggle="collapse" aria-expanded="true" data-parent="#accordion" href="#{{ chapdetails.name }}:{{ subj }}">
                                     <span class="accordion-title-icon-background collapsed"><i class="accordion-title-icon fas fa-plus"></i></span>
                                     <span class="accordion-title-icon-background expanded"><i class="accordion-title-icon fas fa-minus"></i></span>
                                     <font size="3"> {{ chapdetails.name }}</font>
                                 </a>
                             </h6>
                         </div>
                        <div id="{{ chapdetails.name }}:{{ subj }}" class="collapse show">
                            <div class="panel-child-body">
                                <div class="list-group">
                        {% for sess in chapdetails.sessions %}
                        {% if sess.id == session.id %}
                            {% if sess.encrypted %}
                            <a href="{% url 'course:playSessionEnc' chapid sess.id %}" class="selected-item box-no-border list-group-item">
                                <i class="fa fa-pause fa-fw" style="padding-right:10px"></i><font size="2"> {{ sess.name }}</font></a>
                            {% else %}
                                <a href="{% url 'course:playSession' chapid sess.id %}" class="selected-item box-no-border list-group-item">
                                <i class="fa fa-pause fa-fw" style="padding-right:10px"></i><font size="2"> {{ sess.name }}</font></a>
                            {% endif %}
                        {% else %}
                            {% if sess.encrypted %}
                            <a href="{% url 'course:playSessionEnc' chapid sess.id %}" class="box-no-border list-group-item">
                                <i class="fa fa-play fa-fw" style="padding-right:10px"></i><font size="2"> {{ sess.name }}</font></a>
                            {% else %}
                                <a href="{% url 'course:playSession' chapid sess.id %}" class="box-no-border list-group-item">
                                <i class="fa fa-play fa-fw" style="padding-right:10px"></i><font size="2"> {{ sess.name }}</font></a>
                            {% endif %}
                        {% endif %}
                        {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    {% endfor %}
                </div>
                </div>
        </div>
                {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

	var isOwner = "{{isOwner}}";
	var isLive = "{{isLive}}";
	var bucketname = "{{bucketname}}";
	var disableaccess = "{{disableaccess}}";
	var enrolledcourseid = "{{enrolledcourseid}}";
	var liveUrl = "{{liveUrl}}";
	var videokey = "{{videokey}}";
	var debug = "{{debug}}";
	var accessurl = "/access/allow/{{user.id}}/";
	
	var video;
	var manifest;
	var lastplayertime = 0;
	var nowplayer = 0;
	var now = 0;
	var lasttime = 0;
	var lastdurationplayed = 0
	var durationplayed = 0;
	var coreapi = window.coreapi;
	var client = new coreapi.Client();
	var lastdurationsent = 0;
	var playergap = 0;

	var _0xd5d9=["\x67\x65\x74\x54\x69\x6D\x65","\x70\x72\x6F\x74\x6F\x63\x6F\x6C","\x6C\x6F\x63\x61\x74\x69\x6F\x6E","\x2F\x2F","\x68\x6F\x73\x74\x6E\x61\x6D\x65","\x6F\x6E","\x3A","\x70\x6F\x72\x74","\x2F\x63\x6F\x75\x72\x73\x65\x2F\x75\x70\x64\x61\x74\x65\x44\x75\x72\x61\x74\x69\x6F\x6E\x50\x6C\x61\x79\x65\x64\x2F","\x2F","\x66\x6C\x6F\x6F\x72","\x47\x45\x54","\x6F\x70\x65\x6E","\x73\x65\x6E\x64","\x63\x75\x72\x72\x65\x6E\x74\x54\x69\x6D\x65","\x61\x62\x73","\x64\x65\x74\x61\x69\x6C","\x45\x72\x72\x6F\x72\x20\x63\x6F\x64\x65","\x63\x6F\x64\x65","\x6F\x62\x6A\x65\x63\x74","\x65\x72\x72\x6F\x72","\x69\x6E\x73\x74\x61\x6C\x6C\x41\x6C\x6C","\x70\x6F\x6C\x79\x66\x69\x6C\x6C","\x69\x73\x42\x72\x6F\x77\x73\x65\x72\x53\x75\x70\x70\x6F\x72\x74\x65\x64","\x50\x6C\x61\x79\x65\x72","\x42\x72\x6F\x77\x73\x65\x72\x20\x6E\x6F\x74\x20\x73\x75\x70\x70\x6F\x72\x74\x65\x64\x21","\x65\x6E\x63\x70\x6C\x61\x79\x65\x72","\x67\x65\x74\x45\x6C\x65\x6D\x65\x6E\x74\x42\x79\x49\x64","\x66\x61\x6C\x73\x65","\x63\x6F\x6E\x66\x69\x67\x75\x72\x65","\x79\x65\x73","\x74\x69\x6D\x65\x75\x70\x64\x61\x74\x65","\x61\x64\x64\x45\x76\x65\x6E\x74\x4C\x69\x73\x74\x65\x6E\x65\x72","\x70\x6C\x61\x79\x65\x72","\x63\x61\x74\x63\x68","\x74\x68\x65\x6E","\x6C\x6F\x61\x64","\x74\x72\x75\x65","\x68\x74\x74\x70\x73\x3A\x2F\x2F","\x2E\x73\x67\x70\x31\x2E\x63\x64\x6E\x2E\x64\x69\x67\x69\x74\x61\x6C\x6F\x63\x65\x61\x6E\x73\x70\x61\x63\x65\x73\x2E\x63\x6F\x6D\x2F","\x2E\x6D\x70\x64","\x44\x4F\x4D\x43\x6F\x6E\x74\x65\x6E\x74\x4C\x6F\x61\x64\x65\x64","\x44\x55\x4D\x4D\x59\x53\x54\x52\x49\x4E\x47","\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x65\x78\x74","\x74\x65\x73\x74","\x54\x68\x69\x73\x20\x64\x65\x76\x69\x63\x65\x20\x69\x73\x20\x75\x6E\x6B\x6E\x6F\x77\x6E\x2E\x20\x41\x75\x74\x68\x65\x6E\x74\x69\x63\x61\x74\x65\x20\x79\x6F\x75\x72\x73\x65\x6C\x66\x20\x62\x79\x20\x74\x68\x65\x20\x6C\x69\x6E\x6B\x20\x73\x65\x6E\x74\x20\x74\x6F\x20\x79\x6F\x75\x72\x20\x65\x6D\x61\x69\x6C\x2E"];function getUTCTimeSecs(){return  new Date()[_0xd5d9[0]]()/ 1000}function update(){var _0xf855x3=durationplayed- lastdurationsent;lastdurationsent= durationplayed;var isDebug=debug;var url=window[_0xd5d9[2]][_0xd5d9[1]]+ _0xd5d9[3]+ window[_0xd5d9[2]][_0xd5d9[4]];if(isDebug== _0xd5d9[5]){url= url+ _0xd5d9[6]+ window[_0xd5d9[2]][_0xd5d9[7]]};url= url+ _0xd5d9[8]+ enrolledcourseid+ _0xd5d9[9]+ Math[_0xd5d9[10]](_0xf855x3);var xmlHttp= new XMLHttpRequest();xmlHttp[_0xd5d9[12]](_0xd5d9[11],url,true);xmlHttp[_0xd5d9[13]]()}function onPlaying(){now= getUTCTimeSecs();nowplayer= video[_0xd5d9[14]];if(lasttime== 0){lastplayertime= nowplayer;lasttime= now;return};playergap= nowplayer- lastplayertime;if(playergap< 0){lastplayertime= nowplayer;lasttime= now;return};var _0xf855x8=now- lasttime;if(Math[_0xd5d9[15]](_0xf855x8- playergap)< 3){durationplayed= durationplayed+ playergap;lastplayertime= nowplayer;lasttime= now;if(durationplayed- lastdurationplayed> 60){lastdurationplayed= durationplayed;update()};return};if(_0xf855x8> playergap){durationplayed= durationplayed+ playergap};lastplayertime= nowplayer;lasttime= now;if(durationplayed- lastdurationplayed> 60){lastdurationplayed= durationplayed;update()}}function onErrorEvent(_0xf855xa){onError(_0xf855xa[_0xd5d9[16]])}function onError(_0xf855xc){console[_0xd5d9[20]](_0xd5d9[17],_0xf855xc[_0xd5d9[18]],_0xd5d9[19],_0xf855xc)}function initApp(){shaka[_0xd5d9[22]][_0xd5d9[21]]();if(shaka[_0xd5d9[24]][_0xd5d9[23]]()){initPlayer()}else {console[_0xd5d9[20]](_0xd5d9[25])}}function initPlayer(){video= document[_0xd5d9[27]](_0xd5d9[26]);var _0xf855xf= new shaka.Player(video);if(isLive== _0xd5d9[28]){_0xf855xf[_0xd5d9[29]]({drm:{clearKeys:{"{{keyid}}":"{{key}}","{{keyid}}":"{{key}}"}}})};if(isOwner!= _0xd5d9[30]){video[_0xd5d9[32]](_0xd5d9[31],onPlaying)};window[_0xd5d9[33]]= _0xf855xf;_0xf855xf[_0xd5d9[32]](_0xd5d9[20],onErrorEvent);_0xf855xf[_0xd5d9[36]](manifest)[_0xd5d9[35]](function(){})[_0xd5d9[34]](onError)}if(isOwner== _0xd5d9[30]){if(isLive== _0xd5d9[37]){manifest= liveUrl}else {manifest= _0xd5d9[38]+ bucketname+ _0xd5d9[39]+ videokey+ _0xd5d9[9]+ videokey+ _0xd5d9[40]};document[_0xd5d9[32]](_0xd5d9[41],initApp)}else {var accepted=0;var tracktime=0;if(disableaccess){accepted= 1;tracktime= 1}else {var deviceJSON=_0xd5d9[42];var isDebug=debug;var url=window[_0xd5d9[2]][_0xd5d9[1]]+ _0xd5d9[3]+ window[_0xd5d9[2]][_0xd5d9[4]];if(isDebug== _0xd5d9[5]){url= url+ _0xd5d9[6]+ window[_0xd5d9[2]][_0xd5d9[7]]};url= url+ accessurl+ deviceJSON;var xmlHttp= new XMLHttpRequest();xmlHttp[_0xd5d9[12]](_0xd5d9[11],url,false);xmlHttp[_0xd5d9[13]](null);accepted= (/True/)[_0xd5d9[44]](xmlHttp[_0xd5d9[43]])};if(accepted){if(isLive== _0xd5d9[37]){manifest= liveUrl}else {manifest= _0xd5d9[38]+ bucketname+ _0xd5d9[39]+ videokey+ _0xd5d9[9]+ videokey+ _0xd5d9[40]};if(tracktime){document[_0xd5d9[32]](_0xd5d9[41],initApp)}}else {alert(_0xd5d9[45])}}

</script>

    {%  endblock %}
    {%  endblock container %}
</html>
